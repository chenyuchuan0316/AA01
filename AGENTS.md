
======================================
(一) 維護守則
======================================
1.專案定位
- 本儲存庫對應 Google Apps Script 專案，綁定 Google 文件並透過側欄表單批次產出長照計畫書。
- 程式碼需能直接貼入 Apps Script IDE，禁止引入需額外建置的第三方套件或編譯流程。
- 任何改動都要維持與 Google Workspace 服務（DocumentApp、DriveApp、SpreadsheetApp）的既有串接方式。

2.協作流程
- 若須在 Apps Script 端測試，請以 `Extensions → Apps Script` 開啟專案後複製本儲存庫程式碼。
- 修改完成後務必於 IDE 中實際執行 `applyAndSave`，確認公版複製、欄位寫入與命名流程皆正常。
- 提交前請清除暫時用的 `Logger.log`、測試資料或未使用的常數設定。

======================================
(二) 程式模組規範
======================================
1.模組責任
- `Main.gs` 處理功能表、顯示側欄與流程統籌，其餘段落寫入邏輯請集中在對應的 `H1_*.gs` 檔案。
- `Utils.gs` 僅放公用函式，例如尋找標題、區段取代與日期轉換，請避免在此混入業務邏輯。
- 所有外部資源 ID 必須統一配置於 `Constants.gs`，新增或調整時同步更新 README 的環境設定說明。

2.程式設計
- Apps Script 僅支援 ES5/ES6 基礎語法，前端 `Sidebar.html` 不得使用需編譯的框架或模組系統。
- 在 `Sidebar.html` 新增常數或資料表時，請維持現有縮排（2 空格）與簡潔的函式命名。
- 新增函式時優先重用既有工具，例如 `replaceBlockUnderHeading`、`upsertContentUnderHeading` 等，避免重複實作。

======================================
(三) 介面與資料結構
======================================
1.側欄介面
- 側欄表單為純 HTML/CSS/原生 JavaScript，需支援 Google Apps Script HtmlService 環境。
- 互動邏輯須透過 `google.script.run` 呼叫後端函式，所有 DOM 更新應確保在無外部套件的情況下運作。

2.照顧目標資料
- `Sidebar.html` 的 `GOAL_SERVICE_GROUPS` 定義每項正式服務的碼別、預設敘述與量化輸入提示，勾選後系統會自動產生短、中、長期敘述。
- 若要調整顯示文字或服務碼，請同步更新 `GOAL_SERVICE_GROUPS` 並確保 `shortGoalBlock`、`midGoalBlock`、`longGoalBlock` 的輸出格式維持「分隔線→編號→條列」結構。
- 後端 `H1_CareGoals.gs` 會以 `replaceBlockUnderHeading` 將整段文字覆蓋到文件內，請保持輸出內容為多行純文字並含完整標點。

======================================
(四) 文件與驗證
======================================
1.文件維護
- README 需詳述架構、部署、操作流程與照顧目標模板設定，所有大標題一律採「`======================================` + 標題 + `======================================`」格式。
- 變更常數、資料結構或手動流程時請同步更新 README，確保維護者可依文件完成初始化。

2.交付檢查
- 改動結束後需手動核對：自訂功能表能開啟側欄、側欄送出最小案例可成功產檔、照顧目標段落的分隔線與條列格式正確。
- 專案無自動化測試，提交前請確認工作樹乾淨，且未新增未使用的檔案或設定。
=======
# AGENTS 指南

本檔案說明 `/workspace/AA01` 專案的開發習慣與注意事項。若要修改此專案的任何檔案（含文件），請先閱讀以下內容。

## 專案定位
* 這是一個 Google Apps Script 專案，綁定 Google 文件（Google Docs）。
* 目的：協助長照計畫文件的批次填寫，使用者在文件中開啟自訂側欄後輸入資料，即可自動複製公版、寫入段落並命名新檔。

## 程式結構
* `Main.gs` 為進入點，負責顯示 `Sidebar.html` 以及 `applyAndSave(form)` 主流程。
* 其餘 `.gs` 檔案依段落拆分（例如 `H1_CallDate.gs`、`H1_CaseProfile.gs` 等），每支檔案應僅包含對應段落的邏輯。
* `Utils.gs` 和 `FilesVersion.gs` 提供共用工具函式，不應混入業務邏輯。
* `Sidebar.html` 為唯一前端檔案，內含 HTML/CSS/原生 JavaScript，需能於 Google Apps Script HtmlService 正常運作。

## 開發原則
1. **模組責任單一化**：新增功能時，優先尋找對應的 `H1_*.gs` 檔案擴充。如需新增段落請建立新檔案並以 `applyH1_*` 命名。
2. **避免外部依賴**：Apps Script 環境無 npm，請使用平台內建服務（`DocumentApp`、`DriveApp`、`SpreadsheetApp` 等）。
3. **前端相容性**：側欄程式碼僅能使用 ES5/ES6 基礎語法，避免需要編譯的語法或框架。
4. **常數管理**：所有外部資源 ID 必須集中在 `Constants.gs`，修改時請同步更新 README 的「環境設定」。
5. **輸出規格**：所有寫入 Google 文件的函式都應接收 Document Body 與 form 資料物件，不得直接操作 UI 元素。
6. **本地測試**：本專案無自動化測試。如有邏輯調整，請在 Apps Script IDE 內實際跑一次 `applyAndSave` 並確認輸出。

## 提交前檢查
* 確認無多餘的 `Logger.log` 或測試碼。
* 若調整文件結構，請在 README 的「運作流程」或「介面說明」補充。
* 本專案無預設格式化工具，但請維持原有縮排（2 空格）與命名慣例。

## 文件與說明
* README.md 應維持最新、具體的操作指南與架構說明。
* 若新增重大功能，請在 README 加上使用步驟與注意事項。

## 測試與驗證
* 目前無自動化測試。請至少手動確認：
  1. 自訂功能表能顯示並開啟側欄。
  2. 側欄輸入最小必填欄位後，能成功建立新文件且命名正確。
  3. 外部資源（照專/個管師名單）查詢仍可運作。

感謝協助維護本專案！

