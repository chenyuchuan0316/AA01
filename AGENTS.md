# AGENTS 指南（強化版）

本檔案為 `/workspace/AA01` 專案的開發規範。所有在此資料夾內進行的修改（含程式、樣式、文件）皆需遵循以下指引。

## 專案定位與整體原則
- 這是一個綁定 Google 文件的 Google Apps Script（GAS）專案，目的為協助長照計畫文件的批次填寫與產出。
- GAS 執行環境無法使用 npm 或第三方函式庫，請以平台原生 API（DocumentApp、DriveApp、SpreadsheetApp 等）完成需求。
- 側欄前端必須維持 ES5/ES6 基礎語法，確保能在 Google Docs HtmlService 中執行。
- 所有輸出 Google 文件的函式應接收 Document Body 與表單資料物件，避免直接存取 UI 元件。

## 檔案職責
| 檔名 | 職責說明 |
| ---- | -------- |
| `AppCore.gs` | 進入點腳本，負責建立自訂功能表、開啟 `Sidebar.html`，並串接核心流程（例如 `applyAndSave(form)`）。 |
| `DataStore.gs` | 提供資料存取與快取邏輯，例如外部表單、名單或設定值的讀寫。不得混入畫面控制或檔案複製邏輯。 |
| `Sidebar.html` | 側欄前端，包含 HTML/CSS/原生 JavaScript，負責輸入介面、表單驗證與與 GAS 後端互動。 |
| `README.md` | 維護專案說明、環境設定、操作流程與重要變更紀錄。任何功能調整都需同步更新。 |
| `桃園市_長照給付資料庫_v1.xlsx` | 參考資料或匯入清單，請勿直接在程式中硬編列。必要時應透過 `DataStore.gs` 讀取。 |

> 若日後新增 `.gs` 檔案，請依段落或模組職責拆分，檔名以 `H1_*` 或對應功能命名，並在此表格補上職責說明。

## 目錄結構與命名
- 所有段落邏輯請維持單一責任，避免出現大型多段落函式。
- 共用工具或常數請分別放在 `Utils.gs` 與 `Constants.gs`（若檔案不存在請建立），統一管理。
- 新增檔案時須比照既有檔案使用 2 空格縮排、駝峰式命名，以及 `applyH1_*` 函式命名規則。

## 提交前檢查
1. 確認無暫時性程式碼（`Logger.log`、`console.log`、註解掉的測試片段）。
2. 文件類調整需同步更新 `README.md` 的對應段落（環境設定、運作流程或介面說明）。
3. 檢查程式縮排為 2 空格，且遵守 GAS 支援語法（避免使用 `async/await`、`Proxy` 等高階特性）。
4. 若調整檔案職責或流程，記得更新本檔案的對應段落。
5. 透過 Google Apps Script IDE 實際執行一次主流程（`applyAndSave` 或相關觸發函式），確認產出無誤。

## 測試策略
- **核心流程測試**：於 Apps Script IDE 手動執行 `applyAndSave(form)`，使用最小與完整的表單資料，確認文件複製、命名與內容寫入皆成功。
- **資料來源驗證**：如果有對 `DataStore.gs` 的調整，需確認外部資源（Google Sheet、SpreadsheetApp 等）權限正確，並以測試資料跑過一次讀寫。
- **錯誤處理檢查**：刻意提供缺漏欄位或錯誤格式，確保前端提示與後端防呆邏輯正常。
- **回歸測試**：針對受影響的段落函式（例如 `applyH1_*`），再次執行並比對輸出段落是否維持原本格式與占位符替換。

## 行動端驗收
- 於 Google Docs 行動版或瀏覽器的行動模擬模式中開啟文件，確認自訂側欄可正確載入與操作。
- 驗證輸入欄位在狹窄螢幕下仍可閱讀與操作，必要時調整 `Sidebar.html` 之 CSS。
- 測試表單提交流程，確保 Toast 或提示訊息在行動裝置上不會被遮蔽。
- 如需上傳或選擇檔案，請確認觸控操作與權限流程在行動端行得通。

## 文件維護準則
- 重大功能新增、欄位變更或流程異動，必須更新 `README.md` 並在最上方加註「更新日期」。
- 若有外部依賴（例如雲端硬碟範本、第三方 API），請於 README 的環境設定段落補充取得方式與權限需求。
- 圖片或附件應存放於專案內適當目錄，並在 README 中提供說明或連結。

## Codex 任務塊
- 當任務中提供「Codex 指令」或特定 Markdown 區塊時，請完整複製內容，不得自行增刪。
- 若任務要求新增或覆蓋檔案，務必使用對應檔名並確認內容無遺漏。
- 所有指令完成後須使用題示的 Commit 訊息，並在必要時補充 PR 說明。
- 進行多步驟任務時，建議在本檔案或 README 記錄注意事項，避免後續貢獻者遺忘。

## 版本與責任
- 修改本檔案後請立即 Commit，確保規範變動可追蹤。
- 若與實際流程不符，應優先同步修正，避免造成誤導。
- 對於跨檔案影響的需求，請於 Commit 訊息中清楚敘述範圍與目的。

感謝協助維護本專案！
